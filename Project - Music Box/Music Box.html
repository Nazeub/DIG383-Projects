<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="codingSoundFavicon.ico" />

  <title>Lesson 02</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/15.1.5/Tone.min.js"></script>

  <link rel="stylesheet" href="style.css" />

</head>

<body>
  <h1>Music Box</h1>
  <button id="play-btn">Play</button>
  <input type="range" id="pitchShift" min="0.5" max="2" step="0.1" value="1" style="width: 190px;">
  <p>Use the pitch slider to change the pitch of the tune!</p>
  <script>
    // Instantiate a synth
    const synth = new Tone.Synth().toDestination();

    // Add a distortion effect
    const distortion = new Tone.Distortion(0.4).toDestination();
    synth.connect(distortion);

    // Add a reverb effect
    const reverb = new Tone.Reverb({
      wet: 0.5,
      decay: 5,
    }).toDestination();
    distortion.connect(reverb);

    // Define the tune
    let pitchMultiplier = 1;
    const tune = [
      "C4", "E4", "G4", "B4", "E5", "G4", "D4", "F4",
      "A3", "F4", "D4", "B3", "E4", "C3", "C4",
    ];

    // Set up pitch slider
    const slider = document.getElementById("pitchShift");
    slider.addEventListener("input", () => {
      pitchMultiplier = parseFloat(slider.value);
    });

    // Play the tune with the pitch multiplier
    let index = 0;
    function playTune(time) {
      const note = Tone.Frequency(tune[index % tune.length]).transpose(
        12 * (pitchMultiplier - 1)
      );
      synth.triggerAttackRelease(note, "8n", time);
      index++;
    }

    // Set up Tone Transport
    Tone.Transport.scheduleRepeat(playTune, "8n");
    Tone.Transport.bpm.value = 120;

    // Play/Pause Button functionality
    const playBTN = document.getElementById("play-btn");
    let isPlaying = false;
    playBTN.addEventListener("click", async () => {
      await Tone.start();
      if (!isPlaying) {
        Tone.Transport.start();
        playBTN.textContent = "Pause";
      } else {
        Tone.Transport.pause();
        playBTN.textContent = "Play";
      }
      isPlaying = !isPlaying;
    });
  </script>
</body>

</html>
